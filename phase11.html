<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Elisence – Phase 11: Security & Identity Control</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Elisa chat widget script -->
    <script defer src="elisa-chat.js"></script>

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --bg-space: radial-gradient(circle at top, #04101f 0%, #02040a 45%, #000000 100%);
            --text-main: #e8f4fc;
            --text-soft: #cbd5f5;
            --text-muted: #94a3b8;
            --accent: #38bdf8;
            --accent-soft: #7dd3fc;
            --card-bg: rgba(15, 23, 42, 0.96);
            --card-border: rgba(56, 189, 248, 0.9);
            --shadow-strong: 0 0 28px rgba(56, 189, 248, 0.9),
                             0 0 52px rgba(15, 23, 42, 0.9);
        }

        body {
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, Helvetica, sans-serif;
            background: var(--bg-space);
            color: var(--text-main);
            overflow-x: hidden;
        }

        /* ===== top dot + label (مثل index) ===== */
        .top-dot {
            position: fixed;
            left: 18px;
            top: 18px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: radial-gradient(circle, #34c8ff, #0065ff 65%, #000c28 100%);
            box-shadow: 0 0 18px rgba(0, 170, 255, 0.9);
            z-index: 900;
        }

        .top-dot-label {
            position: fixed;
            left: 40px;
            top: 16px;
            font-size: 14px;
            letter-spacing: 0.22em;
            text-transform: uppercase;
            color: #a9d4ff;
            z-index: 900;
        }

        /* ===== side navigation – DESKTOP (دقیقاً مثل index) ===== */
        .side-nav {
            position: fixed;
            right: 32px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 999;
        }

        .nav-btn {
            display: block;
            padding: 13px 38px;
            border-radius: 999px;
            text-decoration: none;
            font-size: 14px;
            letter-spacing: 0.14em;
            text-transform: uppercase;
            color: #e3f2ff;
            background: radial-gradient(circle at top,
                rgba(0, 130, 255, 0.45),
                rgba(0, 10, 35, 0.97));
            border: 1px solid rgba(90, 185, 255, 0.9);
            box-shadow:
                0 0 16px rgba(0, 130, 255, 0.95),
                0 0 34px rgba(0, 40, 120, 0.95);
            transition:
                transform 0.2s ease,
                box-shadow 0.2s ease,
                background 0.2s ease,
                padding 0.2s ease;
        }

        .nav-btn:hover {
            transform: translateX(-4px);
            padding-right: 44px;
            box-shadow:
                0 0 22px rgba(0, 190, 255, 1),
                0 0 46px rgba(0, 80, 200, 1);
            background: radial-gradient(circle at top,
                rgba(0, 170, 255, 0.7),
                rgba(0, 25, 80, 1));
        }

        .nav-btn:active {
            transform: translateX(-2px) scale(0.99);
        }

        /* ===== layout wrapper ===== */
        .page-wrapper {
            max-width: 1200px;
            margin: 0 auto;
            padding: 96px 1.8rem 72px 1.8rem;
        }

        .hero-area {
            margin-bottom: 2.4rem;
        }

        .phase-hero-card {
            background: radial-gradient(circle at top left,
                rgba(56, 189, 248, 0.28),
                rgba(15, 23, 42, 0.98));
            border-radius: 26px;
            border: 1px solid var(--card-border);
            box-shadow: var(--shadow-strong);
            padding: 1.6rem 1.8rem;
        }

        .phase-hero-inner {
            display: flex;
            gap: 1.8rem;
            align-items: stretch;
        }

        .phase-hero-logo-box {
            flex: 0 0 290px;
            border-radius: 22px;
            background: radial-gradient(circle at top, #0b1220, #020617);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem;
            box-shadow:
                0 0 24px rgba(15, 23, 42, 0.9),
                0 0 40px rgba(15, 23, 42, 0.9);
        }

        .phase-hero-logo {
            width: 100%;
            max-width: 360px;
            height: auto;
            border-radius: 18px;
            box-shadow: 0 0 28px rgba(15, 23, 42, 0.95);
        }

        .phase-hero-text-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .phase-label {
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.18em;
            color: var(--text-muted);
            margin-bottom: 0.3rem;
        }

        .phase-title {
            font-size: 1.9rem;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: #f9fafb;
            margin: 0 0 0.35rem 0;
        }

        .phase-subtitle {
            font-size: 0.95rem;
            letter-spacing: 0.14em;
            text-transform: uppercase;
            color: #93c5fd;
            margin-bottom: 0.6rem;
        }

        .phase-lead {
            font-size: 0.98rem;
            color: var(--text-soft);
            margin-bottom: 0.7rem;
        }

        .phase-hero-bullets {
            margin: 0.3rem 0 0 0;
            padding-left: 1.1rem;
            font-size: 0.9rem;
            color: #dbeafe;
        }

        .phase-hero-bullets li {
            margin-bottom: 0.2rem;
        }

        /* ===== detail cards ===== */
        .phase-main {
            max-width: 1100px;
            margin: 0 auto;
        }

        .info-card {
            background: var(--card-bg);
            border-radius: 20px;
            border: 1px solid var(--card-border);
            box-shadow: var(--shadow-strong);
            padding: 1.8rem 1.7rem;
            margin-bottom: 1.8rem;
        }

        .info-card h2 {
            margin-top: 0;
            margin-bottom: 0.85rem;
            font-size: 1.3rem;
            color: var(--accent-soft);
        }

        .info-card h3 {
            margin-top: 1.1rem;
            margin-bottom: 0.4rem;
            font-size: 1.02rem;
            color: #bae6fd;
        }

        .info-card p {
            margin: 0.35rem 0;
            font-size: 0.94rem;
            color: #e5f2ff;
        }

        .info-card ul {
            margin: 0.45rem 0 0.25rem 1.2rem;
            padding-left: 0.3rem;
        }

        .info-card li {
            margin-bottom: 0.32rem;
            font-size: 0.93rem;
        }

        .tagline {
            font-size: 0.94rem;
            color: #93c5fd;
            margin-bottom: 0.45rem;
        }

        .subtle {
            font-size: 0.88rem;
            color: var(--text-muted);
        }

        .highlight {
            border-left: 3px solid var(--accent);
            padding-left: 0.9rem;
            margin-top: 0.4rem;
            font-size: 0.95rem;
            color: var(--text-soft);
        }

        /* ===== responsive (مثل index) ===== */
        @media (max-width: 900px) {
            .page-wrapper {
                padding: 80px 1.2rem 80px 1.2rem;
            }

            .phase-hero-inner {
                flex-direction: column;
            }

            .phase-hero-logo-box {
                flex: 0 0 auto;
            }

            .info-card {
                padding: 1.5rem 1.35rem;
            }

            .side-nav {
                position: fixed;
                right: 50%;
                top: auto;
                bottom: 18px;
                transform: translateX(50%);
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                gap: 8px;
            }

            .nav-btn {
                padding: 9px 20px;
                font-size: 11px;
                letter-spacing: 0.11em;
            }
        }
    </style>
</head>
<body>

<div class="top-dot"></div>
<div class="top-dot-label">ELISENCE</div>

<nav class="side-nav">
    <a class="nav-btn" href="index.html">Home</a>
    <a class="nav-btn" href="index.html#phases">Phases</a>
    <a class="nav-btn" href="about.html">About</a>
    <a class="nav-btn" href="story.html">Story</a>
    <a class="nav-btn" href="video.html">Videos</a>
    <a class="nav-btn" href="contact.html">Contact</a>
</nav>

<div class="page-wrapper">
    <!-- HERO -->
    <section class="hero-area">
        <div class="phase-hero-card">
            <div class="phase-hero-inner">
                <div class="phase-hero-logo-box">
                    <img src="elisence.png"
                         alt="Elisence – Global Digital Health & Humanity Platform"
                         class="phase-hero-logo">
                </div>
                <div class="phase-hero-text-box">
                    <div class="phase-label">PHASE 11</div>
                    <h1 class="phase-title">Security &amp; Identity Control</h1>
                    <div class="phase-subtitle">
                        ZERO-TRUST · PASSPORT V1 · REGULATORY BACKBONE
                    </div>
                    <p class="phase-lead">
                        Phase 11 is the central security, identity, access-control, and regulatory protection
                        layer of Elisence. It ensures that every action, request, file, profile and interaction
                        follows Zero-Trust, BBVP and sovereignty rules — turning Elisence into a secure spine that
                        can support national-scale digital health.
                    </p>
                    <ul class="phase-hero-bullets">
                        <li>Single, governed passport &amp; header standard across all phases.</li>
                        <li>Strict RS256 / kid validation, replay protection and WORM audit logging.</li>
                        <li>Security gateway for Diabetes, Women+, Social Presence, Voice, Kids+, Nutrition and more.</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- DETAIL CARDS -->
    <main class="phase-main">

        <!-- 1. OVERVIEW -->
        <section class="info-card">
            <h2>1. Overview of Phase 11</h2>
            <p>
                Phase 11 is the central security, identity, access-control, and regulatory protection layer of Elisence.
                It is responsible for ensuring that every action, every request, every file, every profile and every
                interaction inside Elisence follows <strong>Zero-Trust</strong>, <strong>BBVP</strong>, and
                <strong>sovereign-compliant</strong> rules.
            </p>
            <p>
                This phase protects the entire ecosystem — from Diabetes (Phase 9) and Women+ (Phase 7) to Social Presence
                (Phase 10), Voice Engine (Phase 13), Kids+, Nutrition, and future modules.
            </p>
            <p class="highlight">
                Phase 11 forms the <strong>Security Backbone</strong> of Elisence — the layer that regulators and
                ministries care about most when they ask: “Can we trust this platform with national health data?”
            </p>
        </section>

        <!-- 2. CURRENT STATUS -->
        <section class="info-card">
            <h2>2. Current Status (Based on the PDF Scan)</h2>
            <p>
                Based on the latest internal PDF scan and repository review, the following elements exist in partial or
                minimal form:
            </p>
            <ul>
                <li><strong>X-Passport</strong> header exists in some routes.</li>
                <li>Some early verification logic is present.</li>
                <li>Access control is partially recognised.</li>
                <li>Behaviour for “bridge not configured” exists in some places.</li>
                <li>Certain JSON 401 responses follow a near-canonical schema.</li>
                <li>Phase 10 header/block is partially integrated.</li>
            </ul>
            <p class="subtle">
                These components exist but are not yet validated, unified, or compliant with the strict, government-grade
                requirements defined for Phase 11.
            </p>
        </section>

        <!-- 3. NOT DONE – REQUIRED SECURITY WORK -->
        <section class="info-card">
            <h2>3. NOT DONE – Required Security Work (Full Breakdown)</h2>
            <p>
                The following items are <strong>not completed</strong> and MUST be implemented exactly in this order.
                They come directly from the Phase 11 specification and are required for any government-level security
                guarantee.
            </p>

            <h3>A. Header Standardization — NOT VERIFIED</h3>
            <ul>
                <li>Accept <strong>only</strong> the header: <code>X-Passport</code>.</li>
                <li>Reject all alternatives:
                    <ul>
                        <li><code>x-elis-passport</code></li>
                        <li><code>Authorization</code></li>
                        <li>any custom header</li>
                    </ul>
                </li>
                <li>Enforce case-insensitive checks for the canonical header name.</li>
                <li>Implement strict <strong>fail-closed</strong> behaviour on any mismatch.</li>
            </ul>

            <h3>B. RSA/RS256 + kid Validation — NOT DONE</h3>
            <ul>
                <li>Every JWT MUST be checked for:
                    <ul>
                        <li><code>alg ≠ RS256</code> → <strong>401</strong></li>
                        <li>missing <code>kid</code> → <strong>401</strong></li>
                        <li>unknown <code>kid</code> → <strong>401</strong></li>
                        <li>corrupted key sets → <strong>401</strong></li>
                    </ul>
                </li>
            </ul>

            <h3>C. Mandatory Claims Validation — NOT DONE</h3>
            <p>Every mandatory claim MUST be validated. Missing or incorrect claims produce a strict 401:</p>
            <ul>
                <li><code>ver</code>, <code>iss</code>, <code>aud</code>, <code>sub</code></li>
                <li><code>role</code>, <code>scopes</code></li>
                <li><code>iat</code>, <code>exp</code>, <code>jti</code></li>
            </ul>
            <p class="subtle">
                Strict type enforcement is required (for example, <code>role</code> MUST NOT be a list).
            </p>

            <h3>D. iss / aud / scopes Validation — NOT DONE</h3>
            <ul>
                <li>Reject wrong <code>iss</code> (issuer).</li>
                <li>Reject invalid <code>ver</code> (version).</li>
                <li>Reject incorrect <code>aud</code> (audience).</li>
                <li>Reject unauthorized <code>scopes</code>.</li>
            </ul>
            <p class="subtle">
                All such failures must return strict, canonical JSON <strong>401</strong> outputs.
            </p>

            <h3>E. Fail-Closed Bridge (503) — NOT DONE</h3>
            <p>
                When a passport is required but the bridge is disabled or misconfigured, the system MUST respond with:
            </p>
            <p><code>{"ok": false, "error": "passport_bridge_not_configured", "trace_id": "...", "message": "..."}</code></p>
            <p class="subtle">
                No exceptions, stack traces or framework error pages are allowed to escape in this mode.
            </p>

            <h3>F. Canonical JSON for 401 / 403 / 503 — PARTIAL</h3>
            <p>Every error must follow an identical, canonical schema for:</p>
            <ul>
                <li><strong>503</strong> – <code>passport_bridge_not_configured</code></li>
                <li><strong>403</strong> – <code>scope_denied</code>, <code>role_invalid</code>,
                    <code>audience_rejected</code>, <code>replay_blocked</code></li>
                <li><strong>401</strong> – <code>invalid_passport</code>, <code>missing_claim</code>,
                    <code>unknown_kid</code>, etc.</li>
            </ul>

            <h3>G. Single Source of Truth (SSOT) Verifier — NOT DONE</h3>
            <p>
                There must be <strong>one – and only one</strong> passport verifier function:
            </p>
            <p><code>elisence_security.passport_v1.verify_passport</code></p>
            <p>
                All phases (8, 9, 10, 13 and beyond) MUST route verification through the same engine.
            </p>

            <h3>H. No Backdoors / No Legacy Headers — NOT DONE</h3>
            <ul>
                <li>No developer bypass headers.</li>
                <li>No legacy headers kept “just for now”.</li>
                <li>No shortcut environment variables that weaken checks.</li>
                <li>No alternative verification path.</li>
            </ul>
            <p class="subtle">
                Security must remain absolute — or the platform fails Zero-Trust.
            </p>

            <h3>I. PASSPORT_V1_REFERENCE_SPEC.md — NOT DONE</h3>
            <p>
                This specification file exists but must be completed with:
            </p>
            <ul>
                <li>Header rules.</li>
                <li>RS256 / <code>kid</code> rules.</li>
                <li>Mandatory claims.</li>
                <li><code>jti</code> replay policies.</li>
                <li>Canonical JSON structures.</li>
                <li>Audit chain rules.</li>
            </ul>
            <p class="subtle">
                This document will be required for ministry and government review.
            </p>

            <h3>J. Phase 11 Test Suite (Verifier Tests) — NOT DONE</h3>
            <p>Tests MUST cover at least the following cases:</p>
            <ul>
                <li>Malformed JWT.</li>
                <li>Unsupported algorithm.</li>
                <li>Missing <code>kid</code>.</li>
                <li>Unknown <code>kid</code>.</li>
                <li>Corrupted signature.</li>
                <li>Wrong <code>iss</code> / <code>ver</code>.</li>
                <li>Expired <code>exp</code> or future <code>iat</code>.</li>
                <li>Missing mandatory claim.</li>
                <li>Wrong claim type.</li>
                <li>One-time <code>jti</code> replay attempt.</li>
            </ul>

            <h3>K. Key Rotation — NOT DONE</h3>
            <ul>
                <li>Support simultaneous validity for old <code>kid</code> + new <code>kid</code>.</li>
                <li>Implement rotation removal tests.</li>
                <li>Ensure audit logging for each key rotation event.</li>
            </ul>

            <h3>L. Replay Protection (jti Store) — NOT DONE</h3>
            <ul>
                <li>Dedicated replay store that enforces:
                    <ul>
                        <li>First use → OK.</li>
                        <li>Second use → BLOCK (<strong>403 replay_blocked</strong>).</li>
                    </ul>
                </li>
                <li>Full audit trail stored in WORM.</li>
            </ul>

            <h3>M. Audit Logging (WORM v2) — NOT VERIFIED</h3>
            <p>Audit requirements:</p>
            <ul>
                <li>Log for valid passport.</li>
                <li>Log for invalid passport.</li>
                <li>Log for replay-blocked events.</li>
                <li><strong>Do not</strong> store the raw JWT.</li>
                <li>Logs must be append-only (WORM).</li>
            </ul>

            <h3>N. Integration with Phase 10 — NOT DONE</h3>
            <p>Required items for Social Presence &amp; Messaging integration:</p>
            <ul>
                <li><code>/auth/passport/issue</code> route using <code>ELIS_ISSUER_SECRET</code>.</li>
                <li>User registration must mint a passport.</li>
                <li>Moments &amp; feed must be scope-protected.</li>
                <li>Secure-links must be replay-safe.</li>
                <li>All Phase 10 APIs must strictly rely on the SSOT verifier.</li>
            </ul>

            <h3>O. Phase 10 Integration Tests — NOT DONE</h3>
            <ul>
                <li><strong>503</strong> when passport is required but disabled.</li>
                <li><strong>register → returns valid passport</strong>.</li>
                <li>Protected endpoints → <strong>200</strong> when passport is valid.</li>
                <li>Replay → <strong>403</strong>.</li>
                <li>Bad config → <strong>503</strong>.</li>
            </ul>

            <h3>P. Evidence Pack — NOT DONE</h3>
            <p>
                The security evidence pack must include:
            </p>
            <ul>
                <li>SHA256 hashes.</li>
                <li>Manifest.</li>
                <li>Feature flags.</li>
                <li>Environment variables used.</li>
                <li>Freeze declaration.</li>
            </ul>
            <p class="subtle">
                This pack is mandatory for government and regulator acceptance.
            </p>
        </section>

        <!-- 4. ALGORITHM SECTION -->
        <section class="info-card">
            <h2>4. Algorithm Section — NOT DONE (But Fully Specified)</h2>
            <p>
                The PDF clearly states that the <strong>algorithmic layer</strong> of Phase 11 is <strong>not
                implemented yet</strong>. This refers to the analytics and telemetry components that sit on top of
                the security and passport layer.
            </p>
            <p>Planned scope includes:</p>
            <ul>
                <li>Telemetry aggregation.</li>
                <li>Behavioural metrics.</li>
                <li>Privacy-preserving analytics.</li>
                <li>Population metrics.</li>
                <li>K-anonymity rules.</li>
                <li>Ministry dashboards.</li>
                <li>Clinician dashboards.</li>
                <li>Retention rules.</li>
            </ul>
            <p class="subtle">
                Current state: vocabulary, schema definitions and event types exist, but the following are missing:
            </p>
            <ul>
                <li>Aggregation engine.</li>
                <li>Analytics module.</li>
                <li>Metric calculations.</li>
                <li>Privacy guard.</li>
                <li>K-anonymity enforcement.</li>
                <li>Dashboard generation.</li>
                <li>Routing logic.</li>
                <li>Evidence tests.</li>
            </ul>
            <p class="highlight">
                This entire Algorithm Layer MUST be implemented <strong>after</strong> the Security Layer is fully
                completed and verified.
            </p>
        </section>

        <!-- 5. EXECUTION ORDER -->
        <section class="info-card">
            <h2>5. Execution Order (Mandatory)</h2>
            <p>
                The sequence of implementation is not optional. To stay compliant with Zero-Trust and BBVP,
                work must follow this order:
            </p>
            <ul>
                <li>Verifier negative tests.</li>
                <li>RS256 / <code>kid</code> validation.</li>
                <li>Mandatory claims enforcement.</li>
                <li><code>iss</code> / <code>aud</code> / <code>scopes</code> logic.</li>
                <li>Replay store implementation.</li>
                <li>Key rotation flows.</li>
                <li>Audit WORM tests.</li>
                <li>Header strictness enforcement.</li>
                <li>Issuer router and minting flows.</li>
                <li>Registration mint flow.</li>
                <li>Protection of Phase 10 social content.</li>
                <li>Phase 10 integration tests.</li>
                <li>Evidence pack (SHA256 + manifest + freeze).</li>
            </ul>
        </section>

        <!-- 6. EXECUTIVE SUMMARY -->
        <section class="info-card">
            <h2>6. Executive Summary</h2>
            <p>
                Phase 11 transforms Elisence into a:
            </p>
            <ul>
                <li><strong>Zero-Trust platform</strong>.</li>
                <li><strong>Government-grade identity system</strong>.</li>
                <li><strong>Internationally compliant environment</strong> (NHS, EU, FDA, GCC, PDPL).</li>
                <li><strong>Replay-protected, audit-secured ecosystem</strong>.</li>
                <li><strong>Safe foundation for all future health engines</strong>.</li>
                <li><strong>Secure gateway for social + clinical interactions</strong>.</li>
            </ul>
            <p class="subtle">
                All critical algorithmic work in this phase is currently <strong>NOT DONE</strong> and must begin
                only after the complete Security Layer is implemented and verified.
            </p>
            <p class="highlight">
                Once Phase 11 is complete, Elisence will have the security spine of a national digital health
                infrastructure — ready to support ministries, hospitals, clinicians and citizens at scale.
            </p>
        </section>

    </main>
</div>

<!-- Elisa chat widget root -->
<div id="elisa-chat-root"></div>

</body>
</html>
